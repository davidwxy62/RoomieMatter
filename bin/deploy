#!/bin/bash
# Stop on errors
set -Eeuo pipefail
# Sanity check command line options
usage() {
    echo "Usage: $0 [--flask] [--react] [--manager]"
}
if [ $# -gt 4 ]; then
    echo "Error: too many arguments"
    usage
    exit 1
fi

if [ $# -eq 0 ]; then
    echo "Error: at least one argument required"
    usage
    exit 1
fi

for arg in "$@"; do
    case $arg in
        --flask)
            pkill -f gunicorn
            gunicorn -b localhost:8000 -w 2 -D roomieMatter:app
            echo "Flask server started"
            ;;
        --react)
            npx webpack
            echo "React app built"
            ;;
        --manager)
            ;;
        *)
            echo "Error: invalid argument"
            usage
            ;;
    esac
done

for arg in "$@"; do
    case $arg in
        --manager)
            sudo pkill -f particleManager.py
            if [ -f var/log/particleManager.log ]; then
                rm -f var/log/particleManager.log
            fi
            if [ ! -d var/log ]; then
                mkdir var/log
            fi
            echo "Starting Particle manager ..."
            sudo python3 -m particleManager
            ;;
        --flask)
            ;;
        --react)
            ;;
        *)
            echo "Error: invalid argument"
            usage
            ;;
    esac
done
